
import React, { createContext, useContext, useState, ReactNode } from 'react';

export type Language = 'en';

export type Direction = 'ltr' | 'rtl';

const translations: Record<string, Record<string, string>> = {
    en: {
        'app.title': 'KoreLang',
        'app.subtitle': '',
        'common.confirm': 'Are you sure?',
        'common.done': 'Done',
        'common.cancel': 'Cancel',
        'common.apply': 'Apply Changes',
        'common.delete': 'Delete',
        'nav.dashboard': 'Dashboard',
        'nav.phonology': 'Phonology Engine',
        'nav.lexicon': 'Lexicon',
        'nav.grammar': 'Syntax & Grammar',
        'nav.genevolve': 'GenEvolve',
        'nav.console': 'Studio Console',
        'nav.source': 'Source Code',
        'nav.script': 'Script Editor',
        'nav.notebook': 'Notebook',
        'console.placeholder': 'Waiting for instruction...',
        'console.refactor_complete': 'Refactoring complete and integrated.',
        'console.review_proposals': 'Review Proposals',
        'console.no_violations': 'The lexicon complies with current phonotactic rules.',
        'console.analyzing': 'Analyzing',
        'console.violations': 'violations',
        'console.available_commands': 'AVAILABLE COMMANDS:',
        'console.help_fix': 'Repairs words that violate project rules.',
        'console.help_clear': 'Clears terminal history.',
        'settings.title': 'Settings',
        'menu.toggle_sidebar': 'Toggle Sidebar',
        'defaults.project_name': 'New Conlang',
        'defaults.author': 'Linguist',
        'defaults.grammar': '// Define your grammar here',
        'defaults.phonology_name': 'Standard Phonology',
        'defaults.gen_constraints': 'CV',
        'defaults.gen_vibe': 'ancient',
        'pos.Noun': 'Noun',
        'pos.Verb': 'Verb',
        'pos.Adjective': 'Adjective',
        'pos.Adverb': 'Adverb',
        'pos.Pronoun': 'Pronoun',
        'pos.Preposition': 'Preposition',
        'pos.Conjunction': 'Conjunction',
        'pos.Interjection': 'Interjection',
        'pos.placeholder': 'Select POS...',
        'lexicon.search': 'Search lexicon...',
        'lexicon.new': 'New Entry',
        'lexicon.edit': 'Edit Entry',
        'lexicon.save': 'Save Entry',
        'lexicon.cancel': 'Cancel',
        'lexicon.word': 'Word',
        'lexicon.ipa': 'IPA',
        'lexicon.pos': 'Part of Speech',
        'lexicon.definition': 'Definition',
        'lexicon.etymology': 'Etymology',
        'lexicon.derived_from': 'Derived From',
        'lexicon.root': 'Root',
        'lexicon.root_option': '-- Root --',
        'lexicon.conflicts_group': 'Conflicts',
        'lexicon.view_mode_pinned': 'Pin Conflicts',
        'lexicon.view_mode_hide': 'Hide Conflicts',
        'lexicon.view_mode_only': 'Show Only Conflicts',
        'lexicon.results_count': 'results',
        'lexicon.entries_count': 'entries',
        'lexicon.ai_gen_btn': 'AI Generate',
        'lexicon.no_matches': 'No matches found.',
        'lexicon.try_adjust': 'Try adjusting filters.',
        'lexicon.descendants': 'Descendants',
        'lexicon.copy_latin': 'Copy Latin Text',
        'lexicon.copy_native': 'Copy Native Script Symbols (PUA)',
        'lexicon.ai_requires_key': 'AI Generation requires an API Key.',
        'lexicon.pos_placeholder': 'Select POS...',
        'lexicon.delete_confirm_title': 'Delete Entry?',
        'lexicon.delete_confirm_desc': 'Delete word?',
        'lexicon.action_cannot_undo': 'Action cannot be undone.',
        'lexicon.filter_options': 'Filter Options',
        'lexicon.search_in': 'Search In',
        'lexicon.non_canon': 'Non-Canon',
        'val.errors_title': 'Validation Errors',
        'val.desc': 'Configure project integrity rules and phonotactics.',
        'val.any_pos': '-- Any POS --',
        'tab.general': 'General',
        'tab.phonotactics': 'Phonotactics',
        'tab.orthography': 'Orthography',
        'tab.sorting': 'Sorting',
        'integrity.title': 'Integrity Warning',
        'integrity.warning': 'Dependents found.',
        'integrity.desc': 'This action may break references.',
        'integrity.action_cancel': 'Cancel',
        'integrity.action_unlink': 'Unlink and Delete',
        'genword.title': 'Word Generator',
        'genword.desc': 'AI word generation',
        'genword.config': 'Configuration',
        'genword.constraints': 'Constraints',
        'genword.constraints_ph': 'Structure...',
        'genword.vibe': 'Vibe',
        'genword.vibe_ph': 'Style...',
        'genword.count': 'Count',
        'genword.dreaming': 'Dreaming...',
        'genword.generate': 'Generate',
        'genword.results': 'Results',
        'genword.keep': 'Keep',
        'genword.clear': 'Clear',
        'genword.placeholder': 'No words generated yet.',
        'genword.edit_add': 'Edit & Add to Dictionary',
        'genevolve.commit_alert': 'Changes committed.',
        'genevolve.title': 'Evolution',
        'genevolve.desc': 'Apply sound changes',
        'genevolve.run': 'Run',
        'genevolve.sound_changes': 'Rules',
        'genevolve.add_rule': 'Add Rule',
        'genevolve.preview': 'Preview',
        'genevolve.commit': 'Commit',
        'genevolve.placeholder': 'No preview.',
        'grammar.title': 'Grammar',
        'grammar.desc': 'Syntax and Morphology',
        'grammar.tab.syntax': 'Syntax',
        'grammar.tab.morphology': 'Morphology',
        'grammar.saved': 'Saved',
        'grammar.bnf_placeholder': 'Grammar rules...',
        'grammar.applies_to': 'Applies to',
        'grammar.type_sentence': 'Test sentence...',
        'grammar.analysis_output': 'Output',
        'grammar.morph_rules': 'Morphology Rules',
        'grammar.add_rule': 'Add Rule',
        'grammar.no_morph_rules': 'No rules.',
        'dashboard.by': 'by',
        'dashboard.lexiconsize': 'Words',
        'dashboard.manage_lexicon': 'Lexicon',
        'dashboard.manage_lexicon_desc': 'View and edit words',
        'dashboard.define_grammar': 'Grammar',
        'dashboard.define_grammar_desc': 'Rules and structure',
        'dashboard.recent_words': 'Recent Activity',
        'dashboard.pos_dist': 'POS Distribution',
        'dashboard.no_data': 'No data available.',
        'dashboard.empty_dict': 'Lexicon is empty. Start by adding a word.',
        'dashboard.create_first': 'Create the first word now.',
        'wizard.overwrite_confirm': 'Overwrite current project?',
        'menu.file': 'File',
        'menu.new_project': 'New',
        'menu.open_project': 'Open',
        'menu.export_json': 'Export',
        'menu.view': 'View',
        'menu.zoom_in': 'Zoom In',
        'menu.zoom_out': 'Zoom Out',
        'menu.tools': 'Tools',
        'menu.validation': 'Validation',
        'menu.settings': 'Settings',
        'menu.preferences': 'Preferences',
        'menu.help': 'Help',
        'menu.docs': 'Docs',
        'menu.about': 'About',
        'menu.env': 'Environment',
        'settings.dark': 'Dark',
        'settings.light': 'Light',
        'settings.tokyo': 'Tokyo Night',
        'settings.tokyo_light': 'Tokyo Light',
        'settings.done': 'Done',
        'wizard.create_title': 'New Project',
        'wizard.create_desc': 'Start fresh',
        'wizard.edit_title': 'Edit Project',
        'wizard.edit_desc': 'Modify metadata',
        'wizard.name': 'Name',
        'wizard.author': 'Author',
        'wizard.constraints': 'Constraints',
        'wizard.optional': 'Optional',
        'wizard.desc': 'Description',
        'wizard.create_btn': 'Create',
        'wizard.save_btn': 'Save',
        'morph.paradigms': 'Paradigms',
        'val.banned_seq': 'Banned Sequence',
        'val.invalid_char': 'Invalid Character',
        'val.must_start': 'Must Start With',
        'val.must_end': 'Must End With',
        'val.structure_fail': 'Structure Failure',
        'val.duplicate': 'Duplicate',
        'val.banned_placeholder': 'Sequence...',
        'val.no_bans': 'No banned sequences.',
        'val.no_restrictions': 'No restrictions.',
        'val.target_placeholder': 'Target...',
        'lbl.allow_duplicates': 'Allow Duplicates',
        'lbl.allow_duplicates_desc': 'Permit multiple entries with same word.',
        'lbl.case_sensitive': 'Case Sensitive',
        'lbl.case_sensitive_desc': 'A != a',
        'lbl.allowed_chars': 'Whitelist',
        'lbl.allowed_chars_desc': 'Regex for allowed characters.',
        'lbl.structure': 'Syllable Regex',
        'lbl.structure_desc': 'Phonotactic pattern.',
        'lbl.starts_with': 'Starts With',
        'lbl.ends_with': 'Ends With',
        'sort.custom_order': 'Alphabet Order',
        'sort.custom_order_desc': 'Define custom sorting.',
        'sort.locale': 'Locale',
        'sort.presets': 'Presets',
        'sort.preset_latin': 'Latin',
        'sort.preset_latin_ext': 'Latin Ext',
        'sort.preset_cyrillic': 'Cyrillic',
        'sort.preset_greek': 'Greek',
        'sort.preset_hiragana': 'Hiragana',
        'sort.preset_katakana': 'Katakana',
        'sort.preset_arabic': 'Arabic',
        'source.title': 'Source',
        'source.desc': 'JSON Inspector',
        'source.reset': 'Reset',
        'source.apply': 'Apply',
        'source.warning': 'Direct editing can break the project.',
        'phonology.ai_generator': 'AI Generator',
        'phonology.vibe_label': 'Description',
        'phonology.vibe_placeholder': 'Describe the sounds...',
        'phonology.analyze_btn': 'Analyze',
        'phonology.generate_btn': 'Generate',
        'phonology.ai_disabled_title': 'AI Disabled',
        'phonology.ai_disabled_desc': 'Enable AI in settings.',
        'phonology.stats': 'Statistics',
        'phonology.inventory': 'Inventory',
        'phonology.consonants': 'Consonants',
        'phonology.vowels': 'Vowels',
        'phonology.syllable_struct': 'Structure',
        'phonology.undefined': 'Undefined',
        'msg.about_title': 'KoreLang',
        'msg.about_desc': 'Developed by zRinexD (https://github.com/rzRudy/)',
        'settings.api_key': 'Gemini API Key',
        'settings.api_key_ph': 'Paste your API key here...',
        'settings.api_key_help': 'How to get a free API Key?',
        'settings.api_key_required': 'API Key is required for Intelligence features',
        'settings.finalize': 'Finalize Changes',
        'settings.help_title': 'Guide: Obtaining API Key',
        'settings.help_subtitle': 'Follow these steps to activate AI features:',
        'settings.help_back': 'Back',
        'settings.help_step_1': 'Go to Google AI Studio',
        'settings.help_step_2': 'Sign in with a Google account',
        'settings.help_step_3': 'Click on "Get API Key" in the sidebar',
        'settings.help_step_4': 'Click on "Create API Key in new project"',
        'settings.help_step_5': 'Copy the generated key and paste it in the field',
        'settings.open_ai_studio': 'Open Google AI Studio',
        'settings.help_is_free': 'Is it free?',
        'settings.help_free_desc': 'Yes, the Gemini free tier is generous and sufficient for most projects.'
    }
};

interface LanguageContextType {
    language: Language;
    setLanguage: (lang: Language) => void;
    t: (key: string) => string;
    direction: Direction;
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
    const [language, setLanguage] = useState<Language>('en');

    const t = (key: string): string => {
        const langPack = translations[language] || translations['en'];
        return langPack.hasOwnProperty(key) ? langPack[key] : key;
    };

    const direction: Direction = ['ar', 'ur', 'sd', 'pa'].includes(language) ? 'rtl' : 'ltr';

    return (
        <LanguageContext.Provider value={{ language, setLanguage, t, direction }}>
            <div dir={direction} className="h-full w-full">
                {children}
            </div>
        </LanguageContext.Provider>
    );
};

export const useTranslation = () => {
    const context = useContext(LanguageContext);
    if (!context) {
        throw new Error('useTranslation must be used within a LanguageProvider');
    }
    return context;
};
